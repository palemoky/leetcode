/**
 * Wide Screen Toggle Feature
 * Allows users to toggle between normal and wide screen modes.
 * Inspired by OI-wiki.
 */

document$.subscribe(() => {
  // Check if toggle button already exists to avoid duplicates
  if (document.querySelector('.md-header__option[title="切换宽屏模式"]')) {
    return;
  }

  // Determine initial state from localStorage
  const isWide = localStorage.getItem('wide-screen') === 'true';
  if (isWide) {
    document.body.setAttribute('data-wide-screen', 'true');
  }

  // Create toggle button
  const button = document.createElement('button');
  button.className = 'md-header__option md-icon';
  button.title = '切换宽屏模式';
  button.setAttribute('aria-label', '切换宽屏模式');

  // Icon:
  button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0 C6.67658395 4.38278824 10.35286936 10.2149769 12 18 C12.48112577 24.13435354 11.3796635 28.39627628 9 34 C-15.36862515 61.84985732 -42.83280255 86.83280255 -69 113 C44.52 113 158.04 113 275 113 C237.38 75.38 237.38 75.38 199 37 C194.60238877 28.20477753 192.89578527 20.8459705 195.84765625 11.2421875 C199.22173424 4.49403152 204.56515218 0.3494045 211.5 -2.375 C219.71662966 -3.8422553 225.71549514 -3.13941759 233 1 C234.92621091 2.60097267 236.79900437 4.26736668 238.62831116 5.97822571 C239.14913365 6.46402424 239.66995615 6.94982278 240.20656115 7.45034248 C245.63746 12.54269105 250.93025869 17.77466102 256.19702148 23.03588867 C257.2545209 24.08874166 258.31221019 25.14140397 259.37007141 26.19389343 C262.20264916 29.01353856 265.03205257 31.83634629 267.86041141 34.66022277 C269.63299947 36.42985461 271.40616228 38.19890866 273.17949104 39.96779823 C278.74481116 45.519507 284.30817352 51.07316635 289.86863559 56.62974089 C296.258443 63.01505368 302.6547697 69.39374092 309.0567469 75.7668516 C314.03049434 80.71895651 318.99843665 85.67683664 323.96204239 90.63910657 C326.91675914 93.5927791 329.87381781 96.54400896 332.83697319 99.48921776 C335.61883913 102.25455362 338.39339305 105.02702533 341.16262627 107.80500984 C342.17543569 108.81858642 343.19078193 109.82963589 344.20892715 110.83785248 C352.36853205 118.92256668 359.03502408 125.65026684 359.375 137.5625 C359.42398438 138.71878906 359.47296875 139.87507812 359.5234375 141.06640625 C358.03711927 152.23597684 350.2875527 159.42482389 342.61962891 166.99560547 C341.45679911 168.16194237 340.29504956 169.32935712 339.1342926 170.49775696 C335.99890974 173.64730924 332.84821085 176.78110387 329.69398928 179.91177511 C326.38596922 183.19959424 323.09104603 186.50049355 319.79428101 189.79959106 C314.25978351 195.3340351 308.71555252 200.85857429 303.16503906 206.37695312 C296.75636554 212.7487026 290.36189343 219.13442951 283.97514212 225.52814758 C277.81693241 231.69267018 271.65021725 237.8486109 265.4791069 244.00021744 C262.85873921 246.61243024 260.24110245 249.2273348 257.62559891 251.84441757 C254.54468597 254.9262118 251.45629591 258.00031727 248.36205864 261.06873131 C247.23039578 262.19325562 246.10123188 263.32030145 244.97482109 264.45008659 C243.43199818 265.99664754 241.88018556 267.53360893 240.32583618 269.068573 C239.4612359 269.92944456 238.59663563 270.79031612 237.70583534 271.6772747 C231.23758197 277.22971003 225.16963569 279.40637481 216.72265625 279.26953125 C210.03863945 278.60784236 204.69744382 276.19087574 200.0625 271.3125 C195.32722233 265.30405805 193.17998456 258.65347745 194 251 C200.77181058 212.18951569 246.1422263 191.8577737 274 164 C161.14 164 48.28 164 -68 164 C-43.25 188.75 -18.5 213.5 7 239 C11.00377662 248.00849739 12.91756266 254.84034295 10.33984375 264.46484375 C7.53726679 270.78580737 2.41972053 275.17905396 -3.875 277.875 C-10.42954503 279.99670244 -17.14507001 279.71472051 -23.57138538 277.2411356 C-32.72473332 272.56334692 -40.08411482 263.07885778 -47.3371582 255.85571289 C-48.43378812 254.76700831 -49.53058991 253.67847684 -50.62754822 252.59010315 C-54.18894009 249.05461389 -57.74517114 245.51395875 -61.30078125 241.97265625 C-62.53333846 240.74546867 -63.7658996 239.51828504 -64.99846458 238.29110527 C-70.12489121 233.1862456 -75.24990228 228.07997177 -80.37121296 222.96997929 C-87.67573741 215.68171572 -94.98864949 208.40210483 -102.31341296 201.13418013 C-107.48592635 196.00042885 -112.64876138 190.85707 -117.8045699 185.70654291 C-120.87526315 182.63948953 -123.94993394 179.57669853 -127.03505898 176.52415657 C-129.93457884 173.65483421 -132.82184872 170.77371759 -135.70043373 167.88339806 C-136.75341537 166.83019678 -137.81062434 165.78120084 -138.872509 164.73697662 C-145.84441086 157.87469681 -151.96422684 151.18890545 -153.62890625 141.2421875 C-153.27133399 123.11117077 -141.22202022 114.06984495 -128.97583008 101.83056641 C-127.9003113 100.75204713 -126.8249948 99.6733261 -125.74986267 98.59442139 C-122.85992495 95.6957383 -119.9668362 92.80022108 -117.07284379 89.90558672 C-115.26124143 88.09326941 -113.45035468 86.28024017 -111.63971519 84.46696091 C-105.31351372 78.13154333 -98.9847708 71.79867766 -92.65356445 65.46826172 C-86.76459698 59.57989675 -80.88125113 53.68595571 -75.00046617 47.78941977 C-69.93459129 42.7104634 -64.86486242 37.63537592 -59.79212302 32.56327569 C-56.76936509 29.5407722 -53.74816605 26.51675053 -50.7308445 23.48881912 C-47.89770445 20.64598574 -45.05978673 17.80800968 -42.21816444 14.9736557 C-41.17882841 13.93536337 -40.14118571 12.8953727 -39.1054039 11.8535347 C-37.68725218 10.42763122 -36.26226579 9.00853512 -34.83699036 7.5897522 C-34.04303266 6.79524973 -33.24907495 6.00074726 -32.43105793 5.18216896 C-23.13238858 -3.1645131 -11.3557042 -6.25626115 0 0 Z " fill="currentColor" transform="translate(153,118)"/></svg>';

  // Add a specific class for precise styling
  button.classList.add('width-toggle-btn');


  button.addEventListener('click', () => {
    const body = document.body;
    const isWide = body.getAttribute('data-wide-screen') === 'true';

    if (isWide) {
      body.removeAttribute('data-wide-screen');
      localStorage.setItem('wide-screen', 'false');
    } else {
      body.setAttribute('data-wide-screen', 'true');
      localStorage.setItem('wide-screen', 'true');
    }
  });

  // Insert button into header
  const target = document.querySelector('.md-header__option[data-md-component="palette"]');
  if (target) {
    target.parentNode.insertBefore(button, target);
  } else {
    // Fallback if palette is missing
    const search = document.querySelector('.md-header__option[data-md-component="search"]');
    if (search) {
      search.parentNode.insertBefore(button, search);
    }
  }
});
