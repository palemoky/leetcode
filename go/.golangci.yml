# golangci-lint configuration
# https://golangci-lint.run/usage/configuration/

version: "2"

run:
  timeout: 5m
  tests: true

linters:
  # 禁用所有默认 linters，只启用明确指定的
  default: none

  enable:
    # 基础检查
    - govet # 官方静态分析工具
    - errcheck # 检查未处理的错误
    - staticcheck # 综合静态分析 (包含 gosimple, unused)
    - ineffassign # 检测无效的赋值

    # 代码质量
    - gocritic # 提供代码质量建议
    - gocyclo # 检查圈复杂度
    - gocognit # 检查认知复杂度
    - funlen # 检查函数长度
    - nestif # 检查深度嵌套的 if 语句

    # 错误处理
    - errorlint # 检查 Go 1.13+ 错误包装
    - nilerr # 检查返回 nil 但错误不为 nil 的情况

    # 性能
    - prealloc # 检查可以预分配的 slice
    - bodyclose # 检查 HTTP response body 是否关闭
    - sqlclosecheck # 检查 sql.Rows/Stmt 是否关闭

    # 安全
    - gosec # 安全检查

    # 风格
    - misspell # 拼写检查
    - unconvert # 检查不必要的类型转换
    - usestdlibvars # 推荐使用标准库常量
    # - unparam # 检查未使用的函数参数 (在 LeetCode 测试中经常误报)
    - nakedret # 检查裸返回
    - dogsled # 检查过多的空白标识符赋值
    - whitespace # 检查不必要的空行

    # 测试
    - thelper # 检测测试辅助函数是否调用 t.Helper()
    # - tparallel # 检测 t.Parallel() 的不当使用 (Go 1.22+ 已修复循环变量捕获问题)

  settings:
    gocyclo:
      min-complexity: 15 # 圈复杂度阈值

    gocognit:
      min-complexity: 30 # 认知复杂度阈值

    funlen:
      lines: 100 # 函数最大行数
      statements: 60 # 函数最大语句数

    nestif:
      min-complexity: 5 # 嵌套复杂度阈值

    gocritic:
      disabled-checks:
        - ifElseChain # 不强制将 if-else 链改写为 switch

    gosec:
      excludes:
        - G404 # 使用弱随机数生成器
        - G602 # 切片索引越界（经常误报）

    misspell:
      locale: US

    nakedret:
      max-func-lines: 30 # 允许裸返回的最大函数行数

    errorlint:
      errorf: true
      asserts: true
      comparison: true

  exclusions:
    rules:
      # 测试文件中放宽某些检查
      - path: _test\.go
        linters:
          - errcheck
          - dupl
          - funlen
          - gocyclo
          - gocognit

issues:
  # 最大问题数 (0 = 无限制)
  max-issues-per-linter: 0
  max-same-issues: 0
